<div class="settings-container">
  <!-- Full-Screen Loader -->
  @if (isSubmitting) {
    <div class="loader-container">
      <div class="loader">
        <div class="loader__ball"></div>
        <div class="loader__ball"></div>
        <div class="loader__ball"></div>
      </div>
    </div>
  }

  <!-- Toasts -->
  @for (toast of toasts; track toast.id) {
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1050;">
      <div
        class="toast {{ toast.type === 'success' ? 'bg-success' : 'bg-danger' }} text-white"
        [class.fade]="!toast.visible"
        [class.show]="toast.visible"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
        style="min-width: 300px;"
      >
        <div class="d-flex">
          <div class="toast-body">
            {{ toast.message }}
          </div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" (click)="hideToast(toast.id)"></button>
        </div>
      </div>
    </div>
  }

  <h2><i class="fas fa-lock"></i> Change Password</h2>

  <form [formGroup]="passwordForm" (ngSubmit)="onChangePassword()" class="password-form">
    <div class="form-group">
      <label for="currentPassword">Current Password</label>
      <input 
        id="currentPassword" 
        type="password" 
        formControlName="currentPassword"
        class="form-control"
        [class.is-invalid]="currentPassword.invalid && currentPassword.touched">
      @if (currentPassword.invalid && currentPassword.touched) {
        <div class="invalid-feedback">Required.</div>
      }
    </div>

    <div class="form-group">
      <label for="newPassword">New Password</label>
      <input 
        id="newPassword" 
        type="password" 
        formControlName="newPassword"
        class="form-control"
        [class.is-invalid]="newPassword.invalid && newPassword.touched">
      @if (newPassword.invalid && newPassword.touched) {
        <div class="invalid-feedback">At least 6 characters.</div>
      }
    </div>

    <div class="form-group">
      <label for="confirmNewPassword">Confirm New Password</label>
      <input 
        id="confirmNewPassword" 
        type="password" 
        formControlName="confirmNewPassword"
        class="form-control"
        [class.is-invalid]="confirmNewPassword.invalid && confirmNewPassword.touched">
      @if (confirmNewPassword.invalid && confirmNewPassword.touched) {
        <div class="invalid-feedback">Must match.</div>
      }
    </div>

    <div class="w-100 d-flex justify-content-center">
      <button type="submit" [disabled]="isSubmitting" class="btn btn-success mt-2">
        <i class="fas fa-key"></i> Change Password
      </button>
    </div>
  </form>
</div>