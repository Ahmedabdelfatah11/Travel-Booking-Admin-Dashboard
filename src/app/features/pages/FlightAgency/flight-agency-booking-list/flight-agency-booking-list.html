<div class="flight-booking-list-container">
  <!-- Full-Screen Loader -->
  @if (loading) {
    <div class="loader-container">
      <div class="loader">
        <div class="loader__ball"></div>
        <div class="loader__ball"></div>
        <div class="loader__ball"></div>
      </div>
    </div>
  }

  <!-- Header -->
  <div class="header">
    <h2>Flight Bookings Management</h2>
    <div class="stats">
      <div class="stat-card">
        <span class="stat-number">{{ bookings.length }}</span>
        <span class="stat-label">Total Bookings</span>
      </div>
      <div class="stat-card">
        <span class="stat-number">{{ filteredBookings.length }}</span>
        <span class="stat-label">Filtered Results</span>
      </div>
      <!-- Status Statistics -->
      <div class="stat-card pending">
        <span class="stat-number">{{ getStatusStats().pending }}</span>
        <span class="stat-label">Pending</span>
      </div>
      <div class="stat-card confirmed">
        <span class="stat-number">{{ getStatusStats().confirmed }}</span>
        <span class="stat-label">Confirmed</span>
      </div>
      <div class="stat-card cancelled">
        <span class="stat-number">{{ getStatusStats().cancelled }}</span>
        <span class="stat-label">Cancelled</span>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  @if (error) {
    <div class="error-message">
      <i class="error-icon">‚ö†Ô∏è</i>
      {{ error }}
      <button (click)="loadBookings()" class="retry-btn">Retry</button>
    </div>
  }

  <!-- Filters Section -->
  <div class="filters-section">
    <h3>Filters</h3>
    <div class="filters-grid">
      <!-- Status Filter -->
      <div class="filter-group">
        <label for="status">Status</label>
        <select id="status" [(ngModel)]="filters.status" (ngModelChange)="onFilterChange()" class="filter-select">
          @for (option of statusOptions; track $index) {
            <option [value]="option.value">{{ option.label }}</option>
          }
        </select>
      </div>

      <!-- Seat Class Filter -->
      <div class="filter-group">
        <label for="seatClass">Seat Class</label>
        <select id="seatClass" [(ngModel)]="filters.seatClass" (ngModelChange)="onFilterChange()" class="filter-select">
          @for (option of seatClassOptions; track $index) {
            <option [value]="option.value">{{ option.label }}</option>
          }
        </select>
      </div>

      <!-- Departure Airport Filter -->
      <div class="filter-group">
        <label for="departureAirport">Departure Airport</label>
        <input type="text" id="departureAirport" [(ngModel)]="filters.departureAirport"
          (ngModelChange)="onFilterChange()" placeholder="Enter airport code or name" class="filter-input">
      </div>

      <!-- Arrival Airport Filter -->
      <div class="filter-group">
        <label for="arrivalAirport">Arrival Airport</label>
        <input type="text" id="arrivalAirport" [(ngModel)]="filters.arrivalAirport" (ngModelChange)="onFilterChange()"
          placeholder="Enter airport code or name" class="filter-input">
      </div>

      <!-- Date From Filter -->
      <div class="filter-group">
        <label for="dateFrom">From Date</label>
        <input type="datetime-local" id="dateFrom" [(ngModel)]="filters.dateFrom" (ngModelChange)="onFilterChange()"
          class="filter-input">
      </div>

      <!-- Date To Filter -->
      <div class="filter-group">
        <label for="dateTo">To Date</label>
        <input type="datetime-local" id="dateTo" [(ngModel)]="filters.dateTo" (ngModelChange)="onFilterChange()"
          class="filter-input">
      </div>

      <!-- Price Min Filter -->
      <div class="filter-group">
        <label for="priceMin">Min Price ($)</label>
        <input type="number" id="priceMin" [(ngModel)]="filters.priceMin" (ngModelChange)="onFilterChange()"
          placeholder="0" min="0" class="filter-input">
      </div>

      <!-- Price Max Filter -->
      <div class="filter-group">
        <label for="priceMax">Max Price ($)</label>
        <input type="number" id="priceMax" [(ngModel)]="filters.priceMax" (ngModelChange)="onFilterChange()"
          placeholder="10000" min="0" class="filter-input">
      </div>

      <!-- Customer Email Filter -->
      <div class="filter-group">
        <label for="customerEmail">Customer Email</label>
        <input type="text" id="customerEmail" [(ngModel)]="filters.customerEmail" (ngModelChange)="onFilterChange()"
          placeholder="Enter customer email" class="filter-input">
      </div>
    </div>

    <div class="filter-actions">
      <button (click)="clearFilters()" class="clear-filters-btn">
        Clear All Filters
      </button>
    </div>
  </div>

  <!-- Bookings Table -->
  @if (!loading && !error) {
    <div class="table-container">
      <table class="bookings-table">
        <thead>
          <tr>
            <th (click)="sort('id')" class="sortable">
              Booking ID {{ getSortIcon('id') }}
            </th>
            <th>Customer</th>
            <th (click)="sort('status')" class="sortable">
              Status {{ getSortIcon('status') }}
            </th>
            <th>Flight Details</th>
            <th (click)="sort('seatClass')" class="sortable">
              Class {{ getSortIcon('seatClass') }}
            </th>
            <th (click)="sort('departureTime')" class="sortable">
              Departure {{ getSortIcon('departureTime') }}
            </th>
            <th (click)="sort('arrivalTime')" class="sortable">
              Arrival {{ getSortIcon('arrivalTime') }}
            </th>
            <th (click)="sort('totalPrice')" class="sortable">
              Price {{ getSortIcon('totalPrice') }}
            </th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (booking of paginatedBookings; track booking.id) {
            <tr class="booking-row">
              <td class="booking-id">#{{ booking.id }}</td>
              <td class="customer-info">
                <div class="customer-email">{{ booking.customerEmail }}</div>
                @if (booking.paymentStatus) {
                  <div class="payment-status">
                    <small [class]="'payment-' + booking.paymentStatus.toLowerCase()">
                      üí≥ {{ booking.paymentStatus }}
                    </small>
                  </div>
                }
              </td>
              <td>
                <span class="status-badge" [class]="getStatusClass(booking.status)">
                  {{ getStatusIcon(booking.status) }} {{ getStatusLabel(booking.status) }}
                </span>
              </td>
              <td class="flight-details">
                <div class="flight-route">
                  <strong>{{ booking.departureAirport }}</strong>
                  <span class="arrow">‚Üí</span>
                  <strong>{{ booking.arrivalAirport }}</strong>
                </div>
                @if (booking.agencyDetails?.airlineName) {
                  <div class="airline-info">
                    <small>{{ booking.agencyDetails?.airlineName }}</small>
                  </div>
                }
                @if (booking.flightId) {
                  <div class="flight-id">
                    <small>Flight ID: {{ booking.flightId }}</small>
                  </div>
                }
              </td>
              <td>
                <span class="seat-class-badge" [class]="getSeatClassBadge(booking.seatClass)">
                  {{ getSeatClassLabel(booking.seatClass) }}
                </span>
              </td>
              <td class="date-time">
                {{ formatDate(booking.departureTime) }}
              </td>
              <td class="date-time">
                {{ formatDate(booking.arrivalTime) }}
              </td>
              <td class="price">
                {{ formatPrice(booking.totalPrice) }}
              </td>
              <td class="actions">
                <div class="action-buttons">
                  <!-- Confirm -->
                  @if (canConfirmBooking(booking)) {
                    <button (click)="confirmBooking(booking.id)" class="action-btn confirm-btn" title="Confirm Booking">
                      <i class="fas fa-check"></i>
                    </button>
                  }

                  <!-- Cancel -->
                  @if (canCancelBooking(booking)) {
                    <button (click)="cancelBooking(booking.id)" class="action-btn cancel-btn" title="Cancel Booking">
                      <i class="fas fa-times"></i>
                    </button>
                  }

                  <!-- Delete -->
                  <button (click)="deleteBooking(booking.id)" class="action-btn delete-btn" title="Delete Booking">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>

      <!-- Empty State -->
      @if (filteredBookings.length === 0) {
        <div class="empty-state">
          <div class="empty-icon">‚úàÔ∏è</div>
          <h3>No Flight Bookings Found</h3>
          <p>No bookings match your current filters. Try adjusting your search criteria.</p>
        </div>
      }
    </div>
  }

  <!-- Pagination -->
  @if (!loading && !error && filteredBookings.length > 0) {
    <div class="pagination">
      <div class="pagination-info">
        Showing {{ (currentPage - 1) * itemsPerPage + 1 }} -
        {{ getMin(currentPage * itemsPerPage, filteredBookings.length) }}
        of {{ filteredBookings.length }} bookings
      </div>

      <div class="pagination-controls">
        <button (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1" class="pagination-btn">
          Previous
        </button>

        @for (page of pageNumbers; track page) {
          <button (click)="changePage(page)" [class.active]="page === currentPage" class="pagination-btn page-number">
            {{ page }}
          </button>
        }

        <button (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages" class="pagination-btn">
          Next
        </button>
      </div>
    </div>
  }
</div>